<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VotingSystem | Admin</title>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet"/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet"/>
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.3.0/mdb.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-notify/0.2.0/css/bootstrap-notify.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-notify/0.2.0/css/styles/alert-bangtidy.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
          <a class="navbar-brand" href="/home">VotingSystem</a>
        </div>
    </nav>
    <div class="container">
        <ul class="nav nav-pills nav-fill" id="ex1" role="tablist">
            <li class="nav-item" role="presentation">
                <a
                    class="nav-link active"
                    id="ex3-tab-1"
                    data-mdb-toggle="pill"
                    href="#ex3-pills-1"
                    role="tab"
                    aria-controls="ex3-pills-1"
                    aria-selected="true"
                    >Liste blanche</a
                >
            </li>
            <li class="nav-item" role="presentation">
                <a
                    class="nav-link"
                    id="ex3-tab-2"
                    data-mdb-toggle="pill"
                    href="#ex3-pills-2"
                    role="tab"
                    aria-controls="ex3-pills-2"
                    aria-selected="false"
                    >Propositions</a
                >
            </li>
            <li class="nav-item" role="presentation">
                <a
                    class="nav-link"
                    id="ex3-tab-3"
                    data-mdb-toggle="pill"
                    href="#ex3-pills-3"
                    role="tab"
                    aria-controls="ex3-pills-3"
                    aria-selected="false"
                    >Vote</a
                >
            </li>
        </ul>
        <div class="tab-content mt-3" id="ex2-content">
            <div
            class="tab-pane fade show active"
            id="ex3-pills-1"
            role="tabpanel"
            aria-labelledby="ex3-tab-1"
            >
                <h2 class="mb-3">Liste blanche</h2>
                <div class="form-outline">
                    <input type="text" class="form-control" id="address-eth"/>
                    <label class="form-label" for="address-eth">Adresse Ethereum</label>
                </div>
                <button type="button" class="btn btn-primary mt-3" id="btn-add-whitelist">Ajouter</button>

            </div>
            <div
            class="tab-pane fade"
            id="ex3-pills-2"
            role="tabpanel"
            aria-labelledby="ex3-tab-2"
            >
                <h2 class="mb-3">Propositions</h2>
                <div class="form-outline">
                    <input type="number" class="form-control" id="proposal-cooldown"/>
                    <label class="form-label" for="proposal-cooldown">Durée</label>
                </div>
                <button type="button" class="btn btn-primary mt-3" id="btn-start-proposal">Démarrer session</button>
                <button type="button" class="btn btn-danger mt-3" id="btn-end-proposal">Stopper session</button>
            </div>
            <div
            class="tab-pane fade"
            id="ex3-pills-3"
            role="tabpanel"
            aria-labelledby="ex3-tab-3"
            >
                <h2 class="mb-3">Vote</h2>
                <div class="form-outline">
                    <input type="number" class="form-control" id="vote-cooldown"/>
                    <label class="form-label" for="vote-cooldown">Durée</label>
                </div>
                <button type="button" class="btn btn-primary mt-3" id="btn-start-vote">Démarrer session</button>
                <button type="button" class="btn btn-danger mt-3" id="btn-end-vote">Stopper session</button>
                <button type="button" class="btn btn-warning mt-3" id="btn-get-vote">Compter les votes</button>
            </div>
        </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.3.0/mdb.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.4/web3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>
<script>
        let account;

        $(document).ready(function() {

            ethereum.enable()
            .then(function (accounts) {
                account = accounts[0];
            })

            // Ajouter à la liste blanche
            $('#btn-add-whitelist').click(function() {
                let address_eth = $('#address-eth').val();
                $.ajax({
                    url:"whitelist",
                    type: "POST",
                    data: {
                        from: account,
                        address: address_eth
                    },
                    dataType: "json",
                }).always(function(result) {
                    if(result.success !== true) {
                        $.notify(result.message, 'error');
                    } else {
                        $.notify(result.message, 'success');
                    }
                })
            }) 

            // Démarrer session enregistrement proposition
            $('#btn-start-proposal').click(function() {
                let cooldown = $('#proposal-cooldown').val();
                $.ajax({
                    url:"start-proposal",
                    type: "POST",
                    data: {
                        from: account,
                        cooldown: cooldown
                    },
                    dataType: "json",
                }).always(function(result) {
                    if(result.success !== true) {
                        $.notify(result.message, 'error');
                    } else {
                        $.notify(result.message, 'success');
                    }
                })
            }) 

            // Fin session enregistrement proposition
            $('#btn-end-proposal').click(function() {
                $.ajax({
                    url:"end-proposal",
                    type: "POST",
                    data: {
                        from: account
                    },
                    dataType: "json",
                }).always(function(result) {
                    if(result.success !== true) {
                        $.notify(result.message, 'error');
                    } else {
                        $.notify(result.message, 'success');
                    }
                })
            }) 
            
            // Démarrer session vote
            $('#btn-start-vote').click(function() {
                let cooldown = $('#vote-cooldown').val();
                $.ajax({
                    url:"start-vote",
                    type: "POST",
                    data: {
                        from: account,
                        cooldown: cooldown
                    },
                    dataType: "json",
                }).always(function(result) {
                    if(result.success !== true) {
                        $.notify(result.message, 'error');
                    } else {
                        $.notify(result.message, 'success');
                    }
                })
            })

            // Fin session vote
            $('#btn-end-vote').click(function() {
                $.ajax({
                    url:"end-vote",
                    type: "POST",
                    data: {
                        from: account
                    },
                    dataType: "json",
                }).always(function(result) {
                    if(result.success !== true) {
                        $.notify(result.message, 'error');
                    } else {
                        $.notify(result.message, 'success');
                    }
                })
            }) 

            // Comptabiliser vote
            $('#btn-get-vote').click(function() {
                $.ajax({
                    url:"get-vote",
                    type: "POST",
                    data: {
                        from: account
                    },
                    dataType: "json",
                }).always(function(result) {
                    if(result.success !== true) {
                        $.notify(result.message, 'error');
                    } else {
                        $.notify(result.message, 'success');
                    }
                })
            }) 
        })
</script>
</html>